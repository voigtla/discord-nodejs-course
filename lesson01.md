# 第1回: JavaScript / Node.js / Discord bot の世界観

## この回で学ぶこと

- JavaScriptとは何か（ブラウザだけの言語ではない）
- Node.jsの役割（JavaScriptをサーバーで動かす魔法）
- イベント駆動の概念（「待ち受けて反応する」仕組み）
- DB（データベース）/ API / Botの関係図

## ゴール

この回を終えたあなたは、**「何を作っているのか」を言葉で説明できる**ようになります。

---

## 1. JavaScriptとは何か？

### JavaScriptの誕生

JavaScriptは、もともと**Webページに動きをつけるため**に生まれた言語です。

```
例: ボタンをクリックしたら色が変わる
    フォームに入力したらエラーメッセージが出る
```

これらは、すべて**ブラウザの中で動くJavaScript**が実現しています。

### なぜDiscord BotでJavaScriptを使うのか？

Discord Botは、Webページではありません。  
では、なぜJavaScriptを使えるのでしょうか？

答えは、**Node.js**にあります。

---

## 2. Node.jsとは何か？

### Node.jsの役割

Node.jsは、**JavaScriptをブラウザの外で実行できるようにした環境**です。

```
ブラウザ内のJavaScript → Webページを動かす
Node.jsのJavaScript   → サーバーやBotを動かす
```

### なぜNode.jsが必要なのか？

Discord Botは、**24時間動き続けるプログラム**です。  
これは、ブラウザを開きっぱなしにして実現するものではありません。

Node.jsを使うことで、JavaScriptを**サーバーのように動かせる**のです。

### Node.jsの強み

1. **非同期処理が得意**（たくさんのメッセージを同時に処理できる）
2. **npmという巨大なライブラリ集がある**（Discord.jsもその一つ）
3. **JavaScriptの知識がそのまま使える**（新しい言語を覚えなくていい）

---

## 3. イベント駆動とは何か？

### 従来のプログラム（順次実行型）

多くのプログラムは、**上から順番に実行される**仕組みです。

```javascript
console.log("1. プログラム開始");
console.log("2. 計算中...");
console.log("3. プログラム終了");
```

これは、**1 → 2 → 3** と順番に実行され、終了します。

### Discord Botの動き方（イベント駆動型）

Discord Botは、**「何かが起きるまで待ち続ける」**プログラムです。

```
Botの動き:
1. プログラム起動
2. Discordに接続
3. ひたすら「メッセージが来るのを待つ」
   ↓
   メッセージが来た! → 処理を実行
   ↓
   また待つ状態に戻る
```

この「**何かが起きたら反応する**」仕組みを、**イベント駆動**と呼びます。

### イベント駆動のイメージ図

```
[Discord サーバー]
      ↓
  メッセージ送信 (イベント発生)
      ↓
[あなたのBot] ← ずっと待機中
      ↓
  イベントに反応して処理
      ↓
  返信メッセージ送信
      ↓
  また待機状態に戻る
```

Botは、**電源を切るまで永遠にこのループを繰り返します**。

---

## 4. Discord Botを構成する3つの要素

Discord Botは、次の3つの要素で成り立っています。

### (1) Bot本体（Node.js + Discord.js）

```
役割: Discordと通信し、メッセージを受け取り、返信する
技術: Node.js、Discord.jsライブラリ
```

### (2) データベース（SQLite）

```
役割: ユーザーの発言履歴、設定値などを記憶する
技術: SQLite（ファイル型の軽量データベース）
```

なぜ必要？
→ Botを再起動しても、**過去の情報を覚えている**ため

### (3) 外部API（Gemini API）

```
役割: AIによる返答を生成する
技術: Google の Gemini API
```

なぜ必要？
→ Bot自身には「会話する知能」がないため、**AIの力を借りる**

---

## 5. 全体の関係図

```
┌─────────────────────────────────────────────┐
│           Discord サーバー                   │
│  (ユーザーがメッセージを送る場所)              │
└─────────────────────────────────────────────┘
                    ↓ ↑
          メッセージ受信 / 返信送信
                    ↓ ↑
┌─────────────────────────────────────────────┐
│         あなたのBot（Node.js）                │
│                                             │
│  ┌─────────────────────────────────┐        │
│  │  Discord.js                     │        │
│  │  (Discordとの通信を担当)         │        │
│  └─────────────────────────────────┘        │
│              ↓              ↓               │
│     ┌────────────┐    ┌────────────┐        │
│     │  SQLite    │    │ Gemini API │        │
│     │  (記憶)    │    │ (AI返答)   │        │
│     └────────────┘    └────────────┘        │
└─────────────────────────────────────────────┘
```

### データの流れ

1. **ユーザー** → Discordにメッセージ送信
2. **Discord** → あなたのBotにメッセージ通知（イベント発生）
3. **Bot** → SQLiteから過去の履歴を取得
4. **Bot** → Gemini APIに「こう返答して」とリクエスト
5. **Gemini API** → AI生成した返答を返す
6. **Bot** → SQLiteに今回のやり取りを保存
7. **Bot** → Discordに返信メッセージを送信
8. **Discord** → ユーザーに返信が表示される

---

## 6. 「イベント駆動」の具体例

### 実際のコードイメージ

```javascript
// Botがメッセージを受け取ったときの処理
client.on('messageCreate', async (message) => {
  // ↑ これが「イベント」
  // 'messageCreate' = 「メッセージが作られたよ」というイベント名
  
  console.log(`受信: ${message.content}`);
  
  // この中に、返信処理を書く
});
```

### ポイント

- `client.on(...)` = 「このイベントが起きたら、この処理をして」という命令
- `'messageCreate'` = イベントの名前（メッセージ受信時に発生）
- `async (message) => { ... }` = 実際に行う処理（次回以降で学びます）

このコードは、**「メッセージが来るまで何もしない」**けれど、  
**「メッセージが来たら即座に反応する」**のです。

---

## 7. なぜこの構成なのか？

### なぜNode.js？

- JavaScriptの知識がそのまま使える
- 非同期処理（同時に複数のメッセージを捌く）が得意
- Discord.jsという強力なライブラリがある

### なぜSQLite？

- ファイル1つで完結する（サーバー不要）
- 軽量で高速
- 小〜中規模のBotには十分な性能

### なぜGemini API？

- 無料枠がある（開発・テストに最適）
- 高性能なAI返答が使える
- APIがシンプルで初心者でも扱いやすい

---

## 8. この講座で作るBotの全体像

### 機能

1. ユーザーがメッセージを送る
2. Botが過去の会話履歴をSQLiteから取得
3. Gemini APIにAI返答を依頼
4. Botが返答をDiscordに送信
5. やり取りをSQLiteに保存

### ファイル構成（最終的に作るもの）

```
my-discord-bot/
├── .env              (APIキーなどの秘密情報)
├── .gitignore        (Gitに含めないファイルのリスト)
├── package.json      (プロジェクト設定)
├── index.js          (Botの起動ファイル)
├── database.js       (SQLite操作)
├── gemini.js         (Gemini API操作)
└── data.db           (SQLiteのデータファイル)
```

---

## 9. プログラミング未経験者への補足

### 「プログラムが動く」とは？

プログラムは、**人間の指示を機械語に翻訳して実行するもの**です。

```
あなたが書くコード (JavaScript)
    ↓ Node.jsが翻訳
機械語 (コンピュータが理解できる言葉)
    ↓
実行される
```

### 「ライブラリ」とは？

**他人が作った便利な部品集**です。

```
例: Discord.js
→ Discordとの通信を簡単にしてくれる部品
→ 自分で一から作ると数千行必要なことが、数行で書ける
```

### 「API」とは？

**他のサービスの機能を借りる窓口**です。

```
例: Gemini API
→ Googleが提供するAIの機能を、あなたのBotから使える
→ 「このテキストに返答して」とお願いすると、AIが返事を返してくれる
```

---

## 10. まとめ：この回で理解すべきこと

### ✅ チェックリスト

- [ ] JavaScriptは、もともとWebページ用の言語だった
- [ ] Node.jsで、JavaScriptをサーバー側で動かせる
- [ ] Discord Botは「イベント駆動」で動く（待ち受けて反応する）
- [ ] Botは、Discord.js + SQLite + Gemini API で構成される
- [ ] イベント駆動とは「何かが起きるまで待ち、起きたら反応する」仕組み

### 次回予告

**第2回: 変数・型・JSON (設定とデータの正体)**

次回は、「データとは何か？」を学びます。

- 変数とは、データに名前をつけること
- 型とは、データの種類（数値、文字、真偽）
- JSONとは、データの構造化された表現
- Botの設定ファイルがどう読まれているか

---

## 11. 言葉で説明してみよう

この回のゴールは、**「何を作っているのか」を言葉で説明できる**ことです。

次の質問に、自分の言葉で答えてみてください。

### Q1: Discord Botは、どうやって動き続けているの？

<details>
<summary>答えの例</summary>

Node.jsというプログラム実行環境で、JavaScriptのコードを動かしている。  
Botは「イベント駆動」という仕組みで、メッセージが来るまで待ち続け、来たら反応する。  
この待機と反応のループを、プログラムを終了するまで永遠に繰り返している。

</details>

### Q2: なぜSQLiteを使うの？

<details>
<summary>答えの例</summary>

Botを再起動しても、過去のやり取りを覚えておくため。  
メモリ上のデータは、プログラムを終了すると消えてしまうが、SQLiteならファイルに保存されるので残る。

</details>

### Q3: Gemini APIは何をしてくれるの？

<details>
<summary>答えの例</summary>

AIによる返答を生成してくれる。  
Bot自身には「会話する知能」がないので、Googleの生成AIの力を借りている。  
APIに「このメッセージに返答して」とお願いすると、適切な返答を返してくれる。

</details>

---

これらの質問に、すらすら答えられるようになれば、第1回は完璧です！

次回、[第2回: 変数・型・JSON (設定とデータの正体)](./lesson02.md) でお会いしましょう。

---

**学習メモ**: この回で分からなかったことを書き留めておきましょう。後の回で理解できることもあります。
